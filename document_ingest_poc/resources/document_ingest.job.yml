resources:
  jobs:
    run_document_ingestion:
      name: run_document_ingestion
      trigger:
        pause_status: UNPAUSED
        file_arrival:
          url: /Volumes/dev_appian_poc/00_bronze/landing_zone/
      tasks:
        - task_key: "raw_document_ingestion"
          pipeline_task:
            pipeline_id: ${resources.pipelines.document_ingest_poc_etl.id}
            full_refresh: false
        - task_key: write_document_content
          depends_on:
            - task_key: "raw_document_ingestion"
          notebook_task:
            notebook_path: ${workspace.file_path}/src/document_transformations_silver/document_content_extraction
            source: WORKSPACE
          environment_key: Default
        - task_key: "document_extract_text"
          depends_on:
            - task_key: "write_document_content"
          pipeline_task:
            pipeline_id: ${resources.pipelines.document_extract_text.id}
            full_refresh: false
        - task_key: write_document_embedding
          depends_on:
            - task_key: "document_extract_text"
          notebook_task:
            notebook_path: ${workspace.file_path}/src/ai_pipelines/gen_ai_solution_dev
            source: WORKSPACE
          environment_key: EmbeddingEnv
      queue:
        enabled: true
      environments:
        - environment_key: Default
          spec:
            environment_version: "4"
        - environment_key: EmbeddingEnv
          spec:
            environment_version: "4"
            dependencies:
              - chonkie==1.5.2
      performance_target: PERFORMANCE_OPTIMIZED
